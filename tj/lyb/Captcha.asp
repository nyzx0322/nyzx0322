<%
Option Explicit
response.buffer=true

call GuCaptcha("GuCaptchaCookies")

sub GuCaptcha(GuCaptchaCookies)

	response.expires=-9999
	response.AddHeader"Pragma","no-cache"
	response.AddHeader"cache-ctrol","no-cache"
	response.ContentType="Image/BMP"

	Randomize

	dim II,JJ,KK
	const CaptchaBlurOdds=4  '杂点出现的机率
	const CaptchaWordAmount=36  '字符数量
	const CaptchaWordData="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"  '验证码将从指定的字符中随机抽取

	dim CaptchaColorData(1)  '颜色的数据[字符/背景]
	CaptchaColorData(0)=ChrB(47)&ChrB(47)&ChrB(47)  '字符颜色代码[黑色:蓝=0/绿=0/红=0]
	CaptchaColorData(1)=ChrB(255)&ChrB(255)&ChrB(255)  '字符背景颜色代码[浅蓝:蓝=250/绿=236/红=211]

	dim CaptchaWordOdds(4),CaptchaWordOddss  '随机产生字符
	for II=0 to 3
		CaptchaWordOdds(II)=Int(Rnd*CaptchaWordAmount)
		CaptchaWordOddss=CaptchaWordOddss&Mid(CaptchaWordData,CaptchaWordOdds(II)+1,1)
	next

	response.cookies(GuCaptchaCookies)=CaptchaWordOddss  '记录 Cookies，大小写转换

	dim CaptchaNumberData(36)  '字符数据
	CaptchaNumberData(0)="1110000111110111101111011110111101001011110100101111010010111101001011110111101111011110111110000111"
	CaptchaNumberData(1)="1111011111110001111111110111111111011111111101111111110111111111011111111101111111110111111100000111"
	CaptchaNumberData(2)="1110000111110111101111011110111111111011111111011111111011111111011111111011111111011110111100000011"
	CaptchaNumberData(3)="1110000111110111101111011110111111110111111100111111111101111111111011110111101111011110111110000111"
	CaptchaNumberData(4)="1111101111111110111111110011111110101111110110111111011011111100000011111110111111111011111111000011"
	CaptchaNumberData(5)="1100000011110111111111011111111101000111110011101111111110111111111011110111101111011110111110000111"
	CaptchaNumberData(6)="1111000111111011101111011111111101111111110100011111001110111101111011110111101111011110111110000111"
	CaptchaNumberData(7)="1100000011110111011111011101111111101111111110111111110111111111011111111101111111110111111111011111"
	CaptchaNumberData(8)="1110000111110111101111011110111101111011111000011111101101111101111011110111101111011110111110000111"
	CaptchaNumberData(9)="1110001111110111011111011110111101111011110111001111100010111111111011111111101111011101111110001111"
	CaptchaNumberData(10)="1111011111111101111111101011111110101111111010111111101011111100000111110111011111011101111000100011"
	CaptchaNumberData(11)="1000000111110111101111011110111101110111110000111111011101111101111011110111101111011110111000000111"
	CaptchaNumberData(12)="1110000011110111101110111110111011111111101111111110111111111011111111101111101111011101111110001111"
	CaptchaNumberData(13)="1000001111110111011111011110111101111011110111101111011110111101111011110111101111011101111000001111"
	CaptchaNumberData(14)="1000000111110111101111011011111101101111110000111111011011111101101111110111111111011110111000000111"
	CaptchaNumberData(15)="1000000111110111101111011011111101101111110000111111011011111101101111110111111111011111111000111111"
	CaptchaNumberData(16)="1110000111110111011110111101111011111111101111111110111111111011100011101111011111011101111110001111"
	CaptchaNumberData(17)="1000100011110111011111011101111101110111110000011111011101111101110111110111011111011101111000100011"
	CaptchaNumberData(18)="1100000111111101111111110111111111011111111101111111110111111111011111111101111111110111111100000111"
	CaptchaNumberData(19)="1110000011111110111111111011111111101111111110111111111011111111101111111110111110111011111000011111"
	CaptchaNumberData(20)="1000100011110111011111011011111101011111110001111111010111111101101111110110111111011101111000100011"
	CaptchaNumberData(21)="1000111111110111111111011111111101111111110111111111011111111101111111110111111111011110111000000011"
	CaptchaNumberData(22)="1000100011110010011111001001111100100111110101011111010101111101010111110101011111010101111001010011"
	CaptchaNumberData(23)="1000100011110011011111001101111101010111110101011111010101111101100111110110011111011001111000110111"
	CaptchaNumberData(24)="1110001111110111011110111110111011111011101111101110111110111011111011101111101111011101111110001111"
	CaptchaNumberData(25)="1000000111110111101111011110111101111011110000011111011111111101111111110111111111011111111000111111"
	CaptchaNumberData(26)="1110001111110111011110111110111011111011101111101110111110111011111011101001101111011001111110001011"
	CaptchaNumberData(27)="1000001111110111011111011101111101110111110000111111010111111101101111110110111111011101111000110011"
	CaptchaNumberData(28)="1110000011110111101111011110111101111111111001111111111001111111111011110111101111011110111100000111"
	CaptchaNumberData(29)="1000000011101101101111110111111111011111111101111111110111111111011111111101111111110111111110001111"
	CaptchaNumberData(30)="1000100011110111011111011101111101110111110111011111011101111101110111110111011111011101111110001111"
	CaptchaNumberData(31)="1000100011110111011111011101111101110111111010111111101011111110101111111010111111110111111111011111"
	CaptchaNumberData(32)="1001010011110101011111010101111101010111110101011111001001111110101111111010111111101011111110101111"
	CaptchaNumberData(33)="1000100011110111011111101011111110101111111101111111110111111110101111111010111111011101111000100011"
	CaptchaNumberData(34)="1000100011110111011111011101111110101111111010111111110111111111011111111101111111110111111110001111"
	CaptchaNumberData(35)="1100000011110111011111111101111111101111111110111111110111111111011111111011111111101110111100000011"

	response.BinaryWrite ChrB(66)&ChrB(77)&ChrB(230)&ChrB(4)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(54)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(40)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(40)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(10)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(1)&ChrB(0)  '输出图像文件头

	response.BinaryWrite ChrB(24)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(176)&ChrB(4)&ChrB(0)&ChrB(0)&ChrB(18)&ChrB(11)&ChrB(0)&ChrB(0)&ChrB(18)&ChrB(11)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)&ChrB(0)'  输出图像信息头

	for II=9 to 0 Step -1  '历经所有行
		for JJ=0 to 3  '历经所有字
			for KK=1 to 10  '历经所有像素
			if rnd*99+1<CaptchaBlurOdds then  '逐行、逐字、逐像素地输出图像数据，随机生成杂点
				response.BinaryWrite CaptchaColorData(0)
			else
				response.BinaryWrite CaptchaColorData(Mid(CaptchaNumberData(CaptchaWordOdds(JJ)),II*10+KK,1))
			end if
			next
		next
	next

end sub
%>